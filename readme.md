# widget for bank

виджет, который показывает несколько последних успешных банковских операций клиента.

## Cтатус разработки: 
в разработке

## Установка:

1 Клонируйте репозиторий:
``` git clone git@github.com:lidiar8r-ops/homework.git  ```

2 Перейдите в папку проекта:
``` cd ваш_репозиторий```

3 Установите зависимости:
``` pip install -r requirements.txt```


## Зависимости
• Python 3.x

• Все библиотеки, которые использованы в проекте указаны в **requirements.txt**
 

## Тестирование
Код покрыт тестами Coverage report: 100%

HTML-отчёт, который показывает, какие строки кода были покрыты тестами, а какие нет в 
[(htmlcov/index.html)](https://github.com/lidiar8r-ops/homework/blob/maim/htmlcov/index.html)

Для запуска тестов воспользуйтесь командой  ```poetry```

## Новое

* Добавлен новый модуль ```get_csv_xls.py``` в нем функция get_csv_xlsx_reader_transaction(path_filename: str) , которая
читает файл CSV или Excel, преобразуя содержимое в список словарей с транзакциями.
* в модуль добавлено логирование


## Реализовано

Логирование в модуле ```utils.py```  и модуле ```masks.py``` 
Логи выводятся в файлы ```utils.log``` и ```masks.log```  в директорию **logs**
Записи лога включают метку времени, название модуля, уровень серьезности и сообщение, описывающее событие или ошибку, 
которые произошли.


В модуле ```generators.py```  3 функции:

**1** Функция  **filter_by_currency**

принимает на вход список словарей, представляющих транзакции и возвращает итератор, который поочередно выдает 
транзакции, отфильтрованные по заданной валюте операции  (например, USD).

***Пример использования функции***
```
usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))
```
Получаем транзакции, где валюта операции соответствует заданной USD.
```
>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
              "id": 142264268,
              "state": "EXECUTED",
              "date": "2019-04-04T23:20:05.206878",
              "operationAmount": {
                  "amount": "79114.93",
                  "currency": {
                      "name": "USD",
                      "code": "USD"
                  }
              },
              "description": "Перевод со счета на счет",
              "from": "Счет 19708645243227258542",
              "to": "Счет 75651667383060284188"
       }       
```

**2** Функция  **ftransaction_descriptions**

Генератор который принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

***Пример использования функции***
```
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    print(next(descriptions))
```
Получаем описание каждой операции по очереди.
```
>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации       
```
**3** Функция  **card_number_generator**

Генератор , который выдает номера банковских карт в формате XXXX XXXX XXXX XXXX, где X  — цифра номера карты. 
Генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999.
Генератор принимает начальное и конечное значения для генерации диапазона номеров.

***Пример использования функции***
```
for card_number in card_number_generator(1, 5):
    print(card_number)
```
Получаем номера карт в заданном диапазоне
```
>>> 0000 0000 0000 0001
    0000 0000 0000 0002
    0000 0000 0000 0003
    0000 0000 0000 0004
    0000 0000 0000 0005       
```
добавлен модуль ```decorators.py```
в нем 1 декоратор **log**, который  автоматически логирует начало и конец выполнения функции, а также ее результаты или
возникшие ошибки.Декоратор принимает необязательный аргумент filename, который определяет, куда будут 
записываться логи (в файл или в консоль):

Если filename задан, логи записываются в указанный файл.

Если filename не задан, логи выводятся в консоль.

Логирование  включает:

* Имя функции и результат выполнения при успешной операции.
* Имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.

***Пример использования функции***
```
@log(filename="mylog.txt")
def my_function(x, y):
    return x + y

my_function(1, 2) 

```


**4**модуль ```utils.py```, который принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых 
транзакциях.

***Пример использования функции***
```
print(get_list_transaction(r'..\data\operations.json'))

```
Получаем список тразакций, вида
```
[
  {
    "id": 441945886,
    "state": "EXECUTED",
    "date": "2019-08-26T10:50:58.294041",
    "operationAmount": {
      "amount": "31957.58",
      "currency": {
        "name": "руб.",
        "code": "RUB"
      }
    },
    "description": "Перевод организации",
    "from": "Maestro 1596837868705199",
    "to": "Счет 64686473678894779589"
  },
  {
    "id": 41428829,
    "state": "EXECUTED",
    "date": "2019-07-03T18:35:29.512364",
    "operationAmount": {
      "amount": "8221.37",
      "currency": {
        "name": "USD",
        "code": "USD"
      }
    },
    "description": "Перевод организации",
    "from": "MasterCard 7158300734726758",
    "to": "Счет 35383033474447895560"
  },
]
```


**5**модуль ```external_api.py``` , который принимает на вход транзакцию и возвращает сумму этой транзакции в рублях. 
Если транзакция была в USD или EUR, происходит обращение к внешнему API для получения текущего курса валют и 
конвертации суммы операции в рубли.


***Пример использования функции***
```
transaction = {
        "id": 41428829,
        "state": "EXECUTED",
        "date": "2019-07-03T18:35:29.512364",
        "operationAmount": {"amount": "100", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод организации",
        "from": "MasterCard 7158300734726758",
        "to": "Счет 35383033474447895560",
    }

print(get_currency_exchange(transaction))

```
Получаем сумму транзакции, для валюты операции USD.
```
>>> 8135.4479

```
**6** файл с данными о финансовых транзациях **operations.json** добавлен в директорию data в корне проекта.


Ожидаемый вывод в лог-файл mylog.txt при успешном выполнении:

```my_function ok```

Ожидаемый вывод при ошибке:

```my_function error: тип ошибки. Inputs: (1, 2), {}```
Где тип ошибки заменяется на текст ошибки.


## Тестирование
Код покрыт тестами Coverage report: 100%

HTML-отчёт, который показывает, какие строки кода были покрыты тестами, а какие нет в 
[(htmlcov/index.html)](https://github.com/lidiar8r-ops/homework/blob/homework_13.1/htmlcov/index.html)

Для запуска тестов воспользуйтесь isort tests
isort src
командой  ```poetry```

## Новое

* Добавлен новый модуль ```get_csv_xls.py``` в нем функция get_csv_xlsx_reader_transaction(path_filename: str) , которая
читает файл CSV или Excel, преобразуя содержимое в список словарей с транзакциями.
* в модуль добавлено логирование


## Реализовано

Логирование в модуле ```utils.py```  и модуле ```masks.py``` 
Логи выводятся в файлы ```utils.log``` и ```masks.log```  в директорию **logs**
Записи лога включают метку времени, название модуля, уровень серьезности и сообщение, описывающее событие или ошибку, 
которые произошли.


В модуле ```generators.py```  3 функции:

**1** Функция  **filter_by_currency**

принимает на вход список словарей, представляющих транзакции и возвращает итератор, который поочередно выдает 
транзакции, отфильтрованные по заданной валюте операции  (например, USD).

***Пример использования функции***
```
usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))
```
Получаем транзакции, где валюта операции соответствует заданной USD.
```
>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
              "id": 142264268,
              "state": "EXECUTED",
              "date": "2019-04-04T23:20:05.206878",
              "operationAmount": {
                  "amount": "79114.93",
                  "currency": {
                      "name": "USD",
                      "code": "USD"
                  }
              },
              "description": "Перевод со счета на счет",
              "from": "Счет 19708645243227258542",
              "to": "Счет 75651667383060284188"
       }       
```

**2** Функция  **ftransaction_descriptions**

Генератор который принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

***Пример использования функции***
```
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    print(next(descriptions))
```
Получаем описание каждой операции по очереди.
```
>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации       
```
**3** Функция  **card_number_generator**

Генератор , который выдает номера банковских карт в формате XXXX XXXX XXXX XXXX, где X  — цифра номера карты. 
Генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999.
Генератор принимает начальное и конечное значения для генерации диапазона номеров.

***Пример использования функции***
```
for card_number in card_number_generator(1, 5):
    print(card_number)
```
Получаем номера карт в заданном диапазоне
```
>>> 0000 0000 0000 0001
    0000 0000 0000 0002
    0000 0000 0000 0003
    0000 0000 0000 0004
    0000 0000 0000 0005       
```
добавлен модуль ```decorators.py```
в нем 1 декоратор **log**, который  автоматически логирует начало и конец выполнения функции, а также ее результаты или
возникшие ошибки.Декоратор принимает необязательный аргумент filename, который определяет, куда будут 
записываться логи (в файл или в консоль):

Если filename задан, логи записываются в указанный файл.

Если filename не задан, логи выводятся в консоль.

Логирование  включает:

* Имя функции и результат выполнения при успешной операции.
* Имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.

***Пример использования функции***
```
@log(filename="mylog.txt")
def my_function(x, y):
    return x + y

my_function(1, 2) 

```


**4**модуль ```utils.py```, который принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых 
транзакциях.

***Пример использования функции***
```
print(get_list_transaction(r'..\data\operations.json'))

```
Получаем список тразакций, вида
```
[
  {
    "id": 441945886,
    "state": "EXECUTED",
    "date": "2019-08-26T10:50:58.294041",
    "operationAmount": {
      "amount": "31957.58",
      "currency": {
        "name": "руб.",
        "code": "RUB"
      }
    },
    "description": "Перевод организации",
    "from": "Maestro 1596837868705199",
    "to": "Счет 64686473678894779589"
  },
  {
    "id": 41428829,
    "state": "EXECUTED",
    "date": "2019-07-03T18:35:29.512364",
    "operationAmount": {
      "amount": "8221.37",
      "currency": {
        "name": "USD",
        "code": "USD"
      }
    },
    "description": "Перевод организации",
    "from": "MasterCard 7158300734726758",
    "to": "Счет 35383033474447895560"
  },
]
```


**5**модуль ```external_api.py``` , который принимает на вход транзакцию и возвращает сумму этой транзакции в рублях. 
Если транзакция была в USD или EUR, происходит обращение к внешнему API для получения текущего курса валют и 
конвертации суммы операции в рубли.


***Пример использования функции***
```
transaction = {
        "id": 41428829,
        "state": "EXECUTED",
        "date": "2019-07-03T18:35:29.512364",
        "operationAmount": {"amount": "100", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод организации",
        "from": "MasterCard 7158300734726758",
        "to": "Счет 35383033474447895560",
    }

print(get_currency_exchange(transaction))

```
Получаем сумму транзакции, для валюты операции USD.
```
>>> 8135.4479

```
**6** файл с данными о финансовых транзациях **operations.json** добавлен в директорию data в корне проекта.


Ожидаемый вывод в лог-файл mylog.txt при успешном выполнении:

```my_function ok```

Ожидаемый вывод при ошибке:

```my_function error: тип ошибки. Inputs: (1, 2), {}```
Где тип ошибки заменяется на текст ошибки.



## Цель разработки: 
научится написание кода на Python в процессе написания виджета 

## Автор
[@lidiar8r-ops](https://github.com/lidiar8r-ops)
